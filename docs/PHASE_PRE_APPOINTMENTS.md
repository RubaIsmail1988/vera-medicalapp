# Phase Pre-Appointments (phase-pre-appointments)

## الهدف
تنفيذ تعديلات صغيرة وضرورية قبل البدء بمرحلة المواعيد، بدون إدخال منطق المواعيد نفسه.

## خارج النطاق
- إنشاء / حجز / جدولة مواعيد
- إشعارات / تذكيرات
- ذكاء اصطناعي / تحليلات
- PIN (الملفات موجودة لكن غير مفعّلة)

---

## Backlog (مُعتمد)

### 1) DoctorSpecificVisitType
- السماح للطبيب بإضافة نوع زيارة خاص به (مثل: Root Canal – 30min).
- AppointmentType يبقى مركزي (Admin فقط).
- التنفيذ:
  - Backend (Model + Serializer + Permissions + Endpoints)
  - UI minimal ضمن شاشة إعدادات الطبيب.
- بدون أي ربط بمنطق الحجز أو المواعيد.

---

### 2) تبويب “الملف الصحي” داخل الإضبارة
- عرض الحقول:
  - BMI
  - health_notes
  - gender
  - blood_type
  - chronic_diseases
- للطبيب:
  - عرض فقط (Read-only).
- للمريض:
  - عرض فقط داخل الإضبارة.
  - التعديل يبقى حصريًا من تبويب الحساب (Account).
- لا منطق ذكي حاليًا (Health insights مؤجلة).

> هذا البند **ملزم بالالتزام الحرفي** بقرار:
> Unified Record Tabs Architecture (راجع docs/DECISIONS.md).

---

### 3) Tab Flicker / Double-Click في الإضبارة
- المشكلة الأصلية:
  - عند الانتقال بين تبويبات الإضبارة (prescriptions / adherence …)
  - يظهر تبويب آخر (غالبًا index 0) لحظة قصيرة أو يحتاج الضغط مرتين.
- الهدف في هذه المرحلة:
  - منع double-click.
  - تثبيت سلوك التنقل بدون كسر routing أو tabs.
- ملاحظة مهمة:
  - معالجة الوميض البصري (flicker) **ليست إلزامية** في هذه المرحلة إذا كانت ستؤدي لتعقيد أو كسر المعمارية.
  - الأهم هو الاستقرار السلوكي (Behavioral stability).

---

### 4) تحسين شاشة Adherence (UX + Layout)
- إضافة سياق للوصفة داخل بطاقة تفاصيل الدواء.
- حل RenderFlex overflow عبر Layout قابل للتمرير.
- إضافة إمكانية:
  - طي / إلغاء اختيار تفاصيل الدواء.
- ملاحظة:
  - منطق عدد الحبات / الالتزام للأبد مؤجل.
  - يُسمح فقط بمراجعة سلوك تواريخ البدء / الانتهاء:
    - تحذير بسيط أو منع إدخال واضح (حسب القرار النهائي).
  - بدون تغيير منطق backend.

---

## Definition of Done
- كل بند أعلاه:
  - مُنفذ بــ commit مستقل وواضح.
- لا تغييرات خارج النطاق المحدد.
- الالتزام الكامل بملفات:
  - docs/DECISIONS.md
  - docs/CODE_REVIEW_CHECKLIST.md
- عدم إدخال Routes جديدة خارج `/app` بدون توثيق قرار صريح.
- الشجرة نظيفة (clean working tree).
- Push إلى الفرع:
  - phase-pre-appointments
